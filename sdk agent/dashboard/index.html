<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDK Trading Agent Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            color: #60a5fa;
            margin-bottom: 5px;
        }

        .header .status {
            font-size: 1.2em;
            color: #10b981;
        }

        .header .status.offline {
            color: #ef4444;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: #1e293b;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            font-size: 1.2em;
            color: #94a3b8;
            margin-bottom: 15px;
            border-bottom: 2px solid #334155;
            padding-bottom: 10px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #334155;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #94a3b8;
        }

        .metric-value {
            font-weight: bold;
            color: #e2e8f0;
        }

        .metric-value.positive {
            color: #10b981;
        }

        .metric-value.negative {
            color: #ef4444;
        }

        .metric-value.warning {
            color: #f59e0b;
        }

        .recent-trades {
            margin-top: 20px;
        }

        .trade-item {
            background: #334155;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 6px;
            border-left: 4px solid #60a5fa;
        }

        .trade-item.win {
            border-left-color: #10b981;
        }

        .trade-item.loss {
            border-left-color: #ef4444;
        }

        .trade-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .trade-strategy {
            font-weight: bold;
            color: #60a5fa;
        }

        .trade-pnl {
            font-weight: bold;
        }

        .trade-details {
            font-size: 0.9em;
            color: #94a3b8;
        }

        .alert {
            background: #7c2d12;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 6px;
        }

        .alert h3 {
            color: #f59e0b;
            margin-bottom: 5px;
        }

        .refresh-info {
            text-align: center;
            color: #64748b;
            margin-top: 20px;
            font-size: 0.9em;
        }

        .last-update {
            text-align: center;
            color: #64748b;
            margin-bottom: 20px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä SDK Trading Agent Dashboard</h1>
            <div class="status" id="status">‚óè LIVE</div>
            <div class="last-update">Last updated: <span id="lastUpdate">--</span></div>
        </div>

        <div id="alerts"></div>

        <div class="grid">
            <!-- Daily Performance -->
            <div class="card">
                <h2>üìà Daily Performance</h2>
                <div class="metric">
                    <span class="metric-label">Total P&L:</span>
                    <span class="metric-value" id="totalPnl">$0.00</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Win Rate:</span>
                    <span class="metric-value" id="winRate">0%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Trades Today:</span>
                    <span class="metric-value" id="tradesCount">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Largest Winner:</span>
                    <span class="metric-value positive" id="largestWinner">$0.00</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Largest Loser:</span>
                    <span class="metric-value negative" id="largestLoser">$0.00</span>
                </div>
            </div>

            <!-- Slippage Statistics -->
            <div class="card">
                <h2>‚ö° Slippage Statistics</h2>
                <div class="metric">
                    <span class="metric-label">Avg Slippage:</span>
                    <span class="metric-value" id="avgSlippage">0.00 ticks</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Max Slippage:</span>
                    <span class="metric-value" id="maxSlippage">0.00 ticks</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Total Slippage Cost:</span>
                    <span class="metric-value negative" id="slippageCost">$0.00</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Running Avg (20):</span>
                    <span class="metric-value" id="runningAvg">0.00 ticks</span>
                </div>
            </div>

            <!-- Latency Statistics -->
            <div class="card">
                <h2>üïê Latency Statistics</h2>
                <div class="metric">
                    <span class="metric-label">Avg Claude Latency:</span>
                    <span class="metric-value" id="avgLatency">0 ms</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Max Claude Latency:</span>
                    <span class="metric-value" id="maxLatency">0 ms</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Total Claude Calls:</span>
                    <span class="metric-value" id="claudeCalls">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Pre-Filter Rate:</span>
                    <span class="metric-value" id="preFilterRate">0%</span>
                </div>
            </div>

            <!-- Risk Metrics -->
            <div class="card">
                <h2>üõ°Ô∏è Risk Metrics</h2>
                <div class="metric">
                    <span class="metric-label">Daily Limit:</span>
                    <span class="metric-value" id="dailyLimit">$250 / -$150</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Trades Remaining:</span>
                    <span class="metric-value" id="tradesRemaining">8</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Position Size:</span>
                    <span class="metric-value" id="positionSize">1 contract</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Risk Per Trade:</span>
                    <span class="metric-value" id="riskPerTrade">$50</span>
                </div>
            </div>
        </div>

        <!-- Recent Trades -->
        <div class="card recent-trades">
            <h2>üìù Recent Trades</h2>
            <div id="recentTrades">
                <div class="trade-item loading">
                    <div class="trade-header">
                        <span class="trade-strategy">Loading...</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="refresh-info">
            Auto-refreshes every 10 seconds
        </div>
    </div>

    <script>
        // Update timestamp
        function updateTimestamp() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleTimeString();
        }

        // Format currency
        function formatCurrency(value) {
            const formatted = Math.abs(value).toFixed(2);
            return value >= 0 ? `$${formatted}` : `-$${formatted}`;
        }

        // Load dashboard data
        async function loadDashboard() {
            try {
                // In a real implementation, this would fetch from the logging files
                // For now, we'll simulate with placeholder data

                // Update daily performance (example data)
                const dailyPnl = 125.50;
                document.getElementById('totalPnl').textContent = formatCurrency(dailyPnl);
                document.getElementById('totalPnl').className = dailyPnl >= 0 ? 'metric-value positive' : 'metric-value negative';

                document.getElementById('winRate').textContent = '65.0%';
                document.getElementById('tradesCount').textContent = '5';
                document.getElementById('largestWinner').textContent = formatCurrency(75.00);
                document.getElementById('largestLoser').textContent = formatCurrency(-25.00);

                // Update slippage stats
                document.getElementById('avgSlippage').textContent = '2.15 ticks';
                document.getElementById('maxSlippage').textContent = '2.80 ticks';
                document.getElementById('slippageCost').textContent = formatCurrency(53.75);
                document.getElementById('runningAvg').textContent = '2.10 ticks';

                // Update latency stats
                document.getElementById('avgLatency').textContent = '387 ms';
                document.getElementById('maxLatency').textContent = '512 ms';
                document.getElementById('claudeCalls').textContent = '12';
                document.getElementById('preFilterRate').textContent = '75.0%';

                // Update risk metrics
                document.getElementById('tradesRemaining').textContent = '3';

                // Load recent trades (example)
                loadRecentTrades();

                // Update timestamp
                updateTimestamp();

                // Set status to online
                document.getElementById('status').textContent = '‚óè LIVE';
                document.getElementById('status').className = 'status';

            } catch (error) {
                console.error('Failed to load dashboard:', error);
                document.getElementById('status').textContent = '‚óè OFFLINE';
                document.getElementById('status').className = 'status offline';
            }
        }

        // Load recent trades
        function loadRecentTrades() {
            // Example trades - in production, this would load from trades.jsonl
            const trades = [
                {
                    strategy: 'VWAP',
                    signal: 'LONG',
                    entry: 21450.25,
                    exit: 21456.50,
                    pnl: 62.50,
                    slippage: 2.5,
                    duration: '12m'
                },
                {
                    strategy: 'Breakout',
                    signal: 'LONG',
                    entry: 21445.00,
                    exit: 21443.75,
                    pnl: -12.50,
                    slippage: 1.8,
                    duration: '5m'
                },
                {
                    strategy: 'Momentum',
                    signal: 'LONG',
                    entry: 21440.50,
                    exit: 21446.00,
                    pnl: 55.00,
                    slippage: 2.2,
                    duration: '18m'
                }
            ];

            const tradesHtml = trades.map(trade => {
                const isWin = trade.pnl > 0;
                const pnlClass = isWin ? 'positive' : 'negative';

                return `
                    <div class="trade-item ${isWin ? 'win' : 'loss'}">
                        <div class="trade-header">
                            <span class="trade-strategy">${trade.strategy} ${trade.signal}</span>
                            <span class="trade-pnl ${pnlClass}">${formatCurrency(trade.pnl)}</span>
                        </div>
                        <div class="trade-details">
                            Entry: ${trade.entry.toFixed(2)} ‚Üí Exit: ${trade.exit.toFixed(2)} |
                            Slippage: ${trade.slippage.toFixed(2)} ticks |
                            Duration: ${trade.duration}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('recentTrades').innerHTML = tradesHtml;
        }

        // Check for alerts
        function checkAlerts() {
            // Example: Check if slippage is high
            const avgSlippage = 2.15;
            const threshold = 3.0;

            if (avgSlippage > threshold) {
                const alertHtml = `
                    <div class="alert">
                        <h3>‚ö†Ô∏è High Slippage Alert</h3>
                        <p>Average slippage (${avgSlippage.toFixed(2)} ticks) exceeds threshold (${threshold} ticks)</p>
                    </div>
                `;
                document.getElementById('alerts').innerHTML = alertHtml;
            } else {
                document.getElementById('alerts').innerHTML = '';
            }
        }

        // Initial load
        loadDashboard();
        checkAlerts();

        // Auto-refresh every 10 seconds
        setInterval(() => {
            loadDashboard();
            checkAlerts();
        }, 10000);
    </script>
</body>
</html>
